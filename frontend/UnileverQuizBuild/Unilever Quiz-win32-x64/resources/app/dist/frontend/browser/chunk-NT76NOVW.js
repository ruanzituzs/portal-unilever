import{b as F,c as j,e as M}from"./chunk-PYD6WGA3.js";import{a as U}from"./chunk-PMGH5KPS.js";import{$a as v,Ab as P,Ba as s,Eb as T,Ia as g,Ib as h,J as C,Ma as k,N as S,Qa as m,T as f,U as x,V as _,W as y,Xa as a,Ya as n,Za as r,_a as u,ab as p,bb as c,cb as E,db as q,eb as l,fb as b,gb as w,hb as Q,yb as V,za as I,zb as A}from"./chunk-G2JQ2GAW.js";var D=(()=>{class t{http;apiUrl=`${h.apiUrl}/certificates`;constructor(e){this.http=e}downloadCertificate(e){return this.http.get(`${this.apiUrl}/${e}/download`,{responseType:"blob"})}static \u0275fac=function(o){return new(o||t)(S(T))};static \u0275prov=C({token:t,factory:t.\u0275fac,providedIn:"root"})}return t})();function $(t,d){t&1&&(n(0,"div",8),u(1,"div",9),n(2,"div",10),l(3,"Carregando avalia\xE7\xE3o..."),r()())}function O(t,d){if(t&1){let e=v();n(0,"button",29),p("click",function(){f(e);let i=c(3);return x(i.skipVideo())}),l(1," Pular v\xEDdeo (Dev) "),r()}}function G(t,d){if(t&1){let e=v();n(0,"div",13)(1,"div",14)(2,"video",15,0),p("ended",function(){f(e);let i=c(2);return x(i.onVideoEnded())}),r()(),n(4,"div",16)(5,"div",17)(6,"div")(7,"span",18),l(8,"V\xEDdeo de Treinamento"),r(),n(9,"h2",19),l(10),r()()(),n(11,"p",20),l(12),r(),n(13,"div",21)(14,"div",22),_(),n(15,"svg",23),u(16,"path",24),r(),y(),n(17,"span",25),l(18,"O quiz ser\xE1 liberado ap\xF3s o t\xE9rmino do v\xEDdeo."),r()(),m(19,O,2,0,"button",26),n(20,"button",27),p("click",function(){f(e);let i=c(2);return x(i.startQuiz())}),n(21,"span"),l(22,"Iniciar Quiz"),r(),_(),n(23,"svg",3),u(24,"path",28),r()()()()()}if(t&2){let e=c(2);s(2),a("src",e.getVideoUrl(e.quiz.video.url),I),s(8),b(e.quiz.video.title),s(2),b(e.quiz.video.description||"Assista ao v\xEDdeo completo para desbloquear o quiz."),s(7),a("ngIf",e.canSkipVideo),s(),a("disabled",!e.videoCompleted)}}function W(t,d){t&1&&u(0,"div",46)}function H(t,d){if(t&1){let e=v();n(0,"button",42),p("click",function(){let i=f(e).index,z=c(3);return x(z.selectAnswer(i))}),n(1,"div",43),m(2,W,1,0,"div",44),r(),n(3,"span",45),l(4),r()()}if(t&2){let e=d.$implicit,o=d.index,i=c(3);q("ring-2",i.selectedAnswerIndex===o)("ring-[#1F36C7]",i.selectedAnswerIndex===o)("bg-blue-50",i.selectedAnswerIndex===o)("border-[#1F36C7]",i.selectedAnswerIndex===o),s(),q("border-[#1F36C7]",i.selectedAnswerIndex===o)("border-gray-300",i.selectedAnswerIndex!==o),s(),a("ngIf",i.selectedAnswerIndex===o),s(2),b(e.text)}}function N(t,d){t&1&&(n(0,"span"),l(1,"Selecione uma resposta para continuar"),r())}function J(t,d){if(t&1){let e=v();n(0,"div",13)(1,"div",30),u(2,"div",31),r(),n(3,"div",16)(4,"div",32)(5,"div")(6,"h2",33),l(7),r(),n(8,"span",34),l(9),r()()(),n(10,"h3",35),l(11),r(),n(12,"div",36),m(13,H,5,14,"button",37),r(),n(14,"div",38)(15,"div",39),m(16,N,2,0,"span",40),r(),n(17,"button",41),p("click",function(){f(e);let i=c(2);return x(i.nextQuestion())}),l(18),r()()()()}if(t&2){let e=c(2);s(2),E("width",(e.currentQuestionIndex+1)/e.quiz.questions.length*100,"%"),s(5),b(e.quiz.title),s(2),Q("Quest\xE3o ",e.currentQuestionIndex+1," de ",e.quiz.questions==null?null:e.quiz.questions.length),s(2),w(" ",e.quiz.questions[e.currentQuestionIndex].text," "),s(2),a("ngForOf",e.quiz.questions[e.currentQuestionIndex].answers),s(3),a("ngIf",e.selectedAnswerIndex===null),s(),a("disabled",e.selectedAnswerIndex===null),s(),w(" ",e.currentQuestionIndex===e.quiz.questions.length-1?"Finalizar Avalia\xE7\xE3o":"Pr\xF3xima Quest\xE3o"," ")}}function K(t,d){if(t&1&&(n(0,"div",11),m(1,G,25,5,"div",12)(2,J,19,10,"div",12),r()),t&2){let e=c();s(),a("ngIf",e.quiz.video&&!e.hasWatchedVideo&&!e.takingQuiz),s(),a("ngIf",e.takingQuiz||!e.quiz.video&&!e.finished)}}function X(t,d){t&1&&u(0,"div",64)}function Y(t,d){t&1&&u(0,"div",65)}function Z(t,d){t&1&&(_(),n(0,"svg",66),u(1,"path",67),r())}function ee(t,d){t&1&&(_(),n(0,"svg",68),u(1,"path",69),r())}function te(t,d){t&1&&(n(0,"span",70),l(1,"Parab\xE9ns! Voc\xEA foi aprovado."),r())}function ie(t,d){t&1&&(n(0,"span",71),l(1,"Voc\xEA n\xE3o atingiu a pontua\xE7\xE3o m\xEDnima."),r())}function ne(t,d){if(t&1){let e=v();n(0,"button",72),p("click",function(){f(e);let i=c(2);return x(i.downloadCertificate())}),_(),n(1,"svg",73),u(2,"path",74),r(),l(3," Baixar Certificado "),r()}}function re(t,d){if(t&1){let e=v();n(0,"button",75),p("click",function(){f(e);let i=c(2);return x(i.retryQuiz())}),l(1," Tentar Novamente "),r()}}function oe(t,d){if(t&1){let e=v();n(0,"div",47),m(1,X,1,0,"div",48)(2,Y,1,0,"div",49),n(3,"div",50),m(4,Z,2,0,"svg",51)(5,ee,2,0,"svg",52),r(),n(6,"h2",53),l(7,"Quiz Conclu\xEDdo!"),r(),n(8,"div",54),l(9),r(),n(10,"p",55),l(11," Voc\xEA acertou "),n(12,"strong",56),l(13),r(),l(14),u(15,"br"),m(16,te,2,0,"span",57)(17,ie,2,0,"span",58),r(),n(18,"p",59),l(19),r(),n(20,"div",60),m(21,ne,4,0,"button",61)(22,re,2,0,"button",62),n(23,"button",63),p("click",function(){f(e);let i=c();return x(i.backToDashboard())}),l(24," Voltar ao Dashboard "),r()()()}if(t&2){let e=c();s(),a("ngIf",e.correctAnswers/e.quiz.questions.length*100>=e.quiz.minScore),s(),a("ngIf",e.correctAnswers/e.quiz.questions.length*100<e.quiz.minScore),s(2),a("ngIf",e.correctAnswers/e.quiz.questions.length*100>=e.quiz.minScore),s(),a("ngIf",e.correctAnswers/e.quiz.questions.length*100<e.quiz.minScore),s(3),q("text-green-600",e.correctAnswers/e.quiz.questions.length*100>=e.quiz.minScore)("text-red-600",e.correctAnswers/e.quiz.questions.length*100<e.quiz.minScore),s(),w(" ",e.Math.round(e.correctAnswers/e.quiz.questions.length*100),"% "),s(4),b(e.correctAnswers),s(),w(" de ",e.quiz==null||e.quiz.questions==null?null:e.quiz.questions.length," quest\xF5es. "),s(2),a("ngIf",e.correctAnswers/e.quiz.questions.length*100>=e.quiz.minScore),s(),a("ngIf",e.correctAnswers/e.quiz.questions.length*100<e.quiz.minScore),s(2),w("+",e.score," Pontos"),s(2),a("ngIf",e.correctAnswers/e.quiz.questions.length*100>=e.quiz.minScore),s(),a("ngIf",e.correctAnswers/e.quiz.questions.length*100<e.quiz.minScore)}}var fe=(()=>{class t{route;router;quizzesService;certificatesService;sanitizer;quiz=null;currentQuestionIndex=0;score=0;correctAnswers=0;finished=!1;selectedAnswerIndex=null;hasWatchedVideo=!1;videoCompleted=!1;takingQuiz=!1;canSkipVideo=!h.production;isSaving=!1;saveError=!1;constructor(e,o,i,z,B){this.route=e,this.router=o,this.quizzesService=i,this.certificatesService=z,this.sanitizer=B}Math=Math;ngOnInit(){let e=this.route.snapshot.paramMap.get("id");e&&(this.quizzesService.getAttempt(e).subscribe(o=>{o&&o.passed&&(this.quiz=o.quiz)}),this.quizzesService.getQuiz(e).subscribe(o=>{this.quiz=o,this.quizzesService.getAttempt(e).subscribe(i=>{if(i&&i.passed){this.finished=!0,this.score=i.score;return}o.video||(this.takingQuiz=!0)})}))}getVideoUrl(e){if(!e)return"";if(e.startsWith("http"))return this.sanitizer.bypassSecurityTrustResourceUrl(e);let o=h.apiUrl.endsWith("/")?h.apiUrl.slice(0,-1):h.apiUrl,i=e.startsWith("/")?e:`/${e}`;return this.sanitizer.bypassSecurityTrustResourceUrl(`${o}${i}`)}onVideoEnded(){this.videoCompleted=!0}skipVideo(){this.videoCompleted=!0}startQuiz(){this.hasWatchedVideo=!0,this.takingQuiz=!0}selectAnswer(e){this.selectedAnswerIndex=e}finishQuiz(){if(!this.quiz)return;this.finished=!0,this.score=this.correctAnswers*100;let o=this.correctAnswers/this.quiz.questions.length*100>=this.quiz.minScore;this.quizzesService.submitAttempt(this.quiz.id,this.score,o).subscribe({next:i=>console.log("Attempt saved",i),error:i=>console.error("Failed to save attempt",i)})}retryQuiz(){this.currentQuestionIndex=0,this.score=0,this.correctAnswers=0,this.finished=!1,this.takingQuiz=!0,this.selectedAnswerIndex=null,this.isSaving=!1,this.saveError=!1}nextQuestion(){if(this.selectedAnswerIndex===null||!this.quiz||!this.quiz.questions)return;this.quiz.questions[this.currentQuestionIndex].answers[this.selectedAnswerIndex].isCorrect&&this.correctAnswers++,this.selectedAnswerIndex=null,this.currentQuestionIndex<this.quiz.questions.length-1?this.currentQuestionIndex++:this.finishQuiz()}downloadCertificate(){if(this.quiz){if(this.isSaving){alert("Aguarde, salvando seu resultado...");return}if(this.saveError){alert("Erro ao salvar resultado. Tente finalizar novamente.");return}this.certificatesService.downloadCertificate(this.quiz.id).subscribe({next:e=>{let o=window.URL.createObjectURL(e),i=document.createElement("a");i.href=o,i.download=`Certificado-${this.quiz?.title}.pdf`,i.click(),window.URL.revokeObjectURL(o)},error:e=>{console.error("Download failed",e),alert("Erro ao baixar certificado. Verifique se voc\xEA atingiu a nota m\xEDnima.")}})}}backToDashboard(){this.router.navigate(["/dashboard"])}static \u0275fac=function(o){return new(o||t)(g(j),g(M),g(U),g(D),g(F))};static \u0275cmp=k({type:t,selectors:[["app-quiz-player"]],decls:9,vars:3,consts:[["videoPlayer",""],[1,"min-h-screen","bg-gray-50","flex","flex-col","items-center","justify-center","p-4"],[1,"absolute","top-4","left-4","flex","items-center","gap-2","text-slate-600","hover:text-[#1F36C7]","transition-colors",3,"click"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-5","h-5"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M10 19l-7-7m0 0l7-7m-7 7h18"],["class","flex flex-col items-center gap-3",4,"ngIf"],["class","w-full max-w-4xl space-y-6",4,"ngIf"],["class","bg-white rounded-2xl shadow-xl max-w-md w-full p-8 text-center animate-enter relative overflow-hidden",4,"ngIf"],[1,"flex","flex-col","items-center","gap-3"],[1,"animate-spin","rounded-full","h-8","w-8","border-b-2","border-[#1F36C7]"],[1,"text-slate-500","font-medium"],[1,"w-full","max-w-4xl","space-y-6"],["class","bg-white rounded-2xl shadow-lg overflow-hidden animate-enter",4,"ngIf"],[1,"bg-white","rounded-2xl","shadow-lg","overflow-hidden","animate-enter"],[1,"bg-black","aspect-video","relative"],["controls","",1,"w-full","h-full","object-contain",3,"ended","src"],[1,"p-8"],[1,"flex","items-start","justify-between","mb-4"],[1,"badge","badge-blue","mb-2"],[1,"text-2xl","font-bold","text-[#101c4f]"],[1,"text-slate-600","mb-6"],[1,"flex","items-center","justify-between","p-4","bg-blue-50","rounded-xl","border","border-blue-100"],[1,"flex","items-center","gap-3"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-6","h-6","text-[#1F36C7]"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"],[1,"text-sm","text-slate-700"],["class","text-sm font-semibold text-slate-500 hover:text-[#1F36C7]",3,"click",4,"ngIf"],[1,"btn","btn-primary","disabled:opacity-50","disabled:cursor-not-allowed",3,"click","disabled"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M14 5l7 7m0 0l-7 7m7-7H3"],[1,"text-sm","font-semibold","text-slate-500","hover:text-[#1F36C7]",3,"click"],[1,"h-2","bg-slate-100"],[1,"h-full","bg-[#1F36C7]","transition-all","duration-500","ease-out"],[1,"flex","justify-between","items-center","mb-8"],[1,"text-xl","font-bold","text-[#101c4f]","mb-1"],[1,"text-sm","text-slate-500"],[1,"text-2xl","font-medium","text-slate-800","mb-8","leading-relaxed"],[1,"space-y-4","mb-8"],["class","w-full text-left p-5 rounded-xl border border-gray-200 hover:bg-gray-50 hover:border-gray-300 transition-all duration-200 flex items-center gap-4 group",3,"ring-2","ring-[#1F36C7]","bg-blue-50","border-[#1F36C7]","click",4,"ngFor","ngForOf"],[1,"flex","justify-between","items-center","pt-6","border-t","border-gray-100"],[1,"text-sm","text-slate-400"],[4,"ngIf"],[1,"btn","btn-primary","disabled:opacity-50","disabled:cursor-not-allowed","px-8",3,"click","disabled"],[1,"w-full","text-left","p-5","rounded-xl","border","border-gray-200","hover:bg-gray-50","hover:border-gray-300","transition-all","duration-200","flex","items-center","gap-4","group",3,"click"],[1,"w-6","h-6","rounded-full","border-2","flex","items-center","justify-center","transition-colors"],["class","w-3 h-3 rounded-full bg-[#1F36C7]",4,"ngIf"],[1,"text-lg","text-slate-700","group-hover:text-slate-900","transition-colors"],[1,"w-3","h-3","rounded-full","bg-[#1F36C7]"],[1,"bg-white","rounded-2xl","shadow-xl","max-w-md","w-full","p-8","text-center","animate-enter","relative","overflow-hidden"],["class","absolute top-0 left-0 w-full h-2 bg-gradient-to-r from-green-500 to-[#1F36C7]",4,"ngIf"],["class","absolute top-0 left-0 w-full h-2 bg-gradient-to-r from-red-500 to-orange-500",4,"ngIf"],[1,"mb-6","inline-flex","p-4","rounded-full","bg-slate-50"],["class","h-16 w-16 text-green-500","fill","none","viewBox","0 0 24 24","stroke","currentColor",4,"ngIf"],["class","h-16 w-16 text-red-500","fill","none","viewBox","0 0 24 24","stroke","currentColor",4,"ngIf"],[1,"text-2xl","font-bold","text-[#101c4f]","mb-2"],[1,"text-5xl","font-bold","mb-4"],[1,"text-slate-600","mb-8"],[1,"text-[#101c4f]"],["class","text-green-600 font-medium",4,"ngIf"],["class","text-red-600 font-medium",4,"ngIf"],[1,"text-sm","font-bold","text-blue-600","mb-6"],[1,"space-y-3"],["class","w-full btn bg-[#37b789] hover:bg-[#2d9d73] text-white shadow-lg shadow-green-500/20",3,"click",4,"ngIf"],["class","w-full btn btn-primary",3,"click",4,"ngIf"],[1,"w-full","btn","btn-outline",3,"click"],[1,"absolute","top-0","left-0","w-full","h-2","bg-gradient-to-r","from-green-500","to-[#1F36C7]"],[1,"absolute","top-0","left-0","w-full","h-2","bg-gradient-to-r","from-red-500","to-orange-500"],["fill","none","viewBox","0 0 24 24","stroke","currentColor",1,"h-16","w-16","text-green-500"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"],["fill","none","viewBox","0 0 24 24","stroke","currentColor",1,"h-16","w-16","text-red-500"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"],[1,"text-green-600","font-medium"],[1,"text-red-600","font-medium"],[1,"w-full","btn","bg-[#37b789]","hover:bg-[#2d9d73]","text-white","shadow-lg","shadow-green-500/20",3,"click"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-5","h-5","mr-2"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"],[1,"w-full","btn","btn-primary",3,"click"]],template:function(o,i){o&1&&(n(0,"div",1)(1,"button",2),p("click",function(){return i.backToDashboard()}),_(),n(2,"svg",3),u(3,"path",4),r(),y(),n(4,"span"),l(5,"Voltar"),r()(),m(6,$,4,0,"div",5)(7,K,3,2,"div",6)(8,oe,25,16,"div",7),r()),o&2&&(s(6),a("ngIf",!i.quiz),s(),a("ngIf",i.quiz&&!i.finished),s(),a("ngIf",i.finished))},dependencies:[P,V,A],encapsulation:2})}return t})();export{fe as QuizPlayerComponent};
